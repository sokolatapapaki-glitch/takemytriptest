// ==================== Î£Î¥Î£Î¤Î—ÎœÎ‘ Î Î¡ÎŸÎ£Î˜Î—ÎšÎ—Î£ ÎÎ•Î©Î Î ÎŸÎ›Î•Î©Î ====================
// Created for Travel Family Planner
// ÎœÏ€Î¿ÏÎµÎ¯Ï‚ Î½Î± Ï€ÏÎ¿ÏƒÎ¸Î­ÏƒÎµÎ¹Ï‚ Î½Î­ÎµÏ‚ Ï€ÏŒÎ»ÎµÎ¹Ï‚ Î§Î©Î¡Î™Î£ Î½Î± Î±Î»Î»Î¬Î¶ÎµÎ¹Ï‚ Ï„Î¿Î½ ÎºÏÎ´Î¹ÎºÎ±!

// Î›Î™Î£Î¤Î‘ ÎÎ•Î©Î Î ÎŸÎ›Î•Î©Î - ÎœÎ ÎŸÎ¡Î•Î™Î£ ÎÎ‘ Î¤Î™Î£ Î‘Î›Î›Î‘Î–Î•Î™Î£!
const EXTRA_CITIES_CONFIG = {
  "Î Î±ÏÎ¯ÏƒÎ¹": {
    file: "data/paris.json",
    enabled: true,
    emoji: "ğŸ—¼"
  },
  "Î‘Î¸Î®Î½Î±": {
    file: "data/athens.json",
    enabled: true,
    emoji: "ğŸ›ï¸"
  },
  "Î¡ÏÎ¼Î·": {
    file: "data/rome.json",
    enabled: true,
    emoji: "ğŸ•"
  }
};

// CACHE Î“Î™Î‘ Î“Î¡Î—Î“ÎŸÎ¡Î— Î Î¡ÎŸÎ£Î’Î‘Î£Î—
let extraCitiesCache = {};

// ÎšÎ¥Î¡Î™Î‘ Î£Î¥ÎÎ‘Î¡Î¤Î—Î£Î—: Î¦Î¿ÏÏ„ÏÎ½ÎµÎ¹ Ï€ÏŒÎ»Î· Î±Ï€ÏŒ ÎµÎ¾Ï‰Ï„ÎµÏÎ¹ÎºÏŒ Î±ÏÏ‡ÎµÎ¯Î¿
async function loadExtraCity(cityName) {
  console.log(`ğŸ” Î¨Î¬Ï‡Î½Ï‰ Î³Î¹Î± ÎµÎ¾Ï‰Ï„ÎµÏÎ¹ÎºÎ® Ï€ÏŒÎ»Î·: ${cityName}`);
  
  // 1. ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ Î±Î½ Î· Ï€ÏŒÎ»Î· Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ ÏƒÏ„Î· Î»Î¯ÏƒÏ„Î± Î¼Î±Ï‚
  const cityConfig = EXTRA_CITIES_CONFIG[cityName];
  if (!cityConfig || !cityConfig.enabled) {
    console.log(`âŒ Î— Ï€ÏŒÎ»Î· ${cityName} Î´ÎµÎ½ ÎµÎ¯Î½Î±Î¹ Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î·`);
    return null;
  }
  
  // 2. ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ cache (Î³Î¹Î± Î½Î± Î¼Î·Î½ Ï†Î¿ÏÏ„ÏÎ½Î¿Ï…Î¼Îµ Î¾Î±Î½Î¬ ÎºÎ±Î¹ Î¾Î±Î½Î¬)
  if (extraCitiesCache[cityName]) {
    console.log(`âœ… Î’ÏÎ®ÎºÎ± ${cityName} ÏƒÏ„Î¿ cache!`);
    return extraCitiesCache[cityName];
  }
  
  // 3. Î¦ÏŒÏÏ„Ï‰ÏƒÎ· Î±Ï€ÏŒ Î±ÏÏ‡ÎµÎ¯Î¿
  try {
    console.log(`ğŸ“¥ Î¦ÏŒÏÏ„Ï‰ÏƒÎ· ${cityName} Î±Ï€ÏŒ: ${cityConfig.file}`);
    const response = await fetch(cityConfig.file);
    
    if (!response.ok) {
      console.error(`âŒ Î”ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ Î±ÏÏ‡ÎµÎ¯Î¿: ${cityConfig.file}`);
      return null;
    }
    
    const cityData = await response.json();
    
    // 4. Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ· ÏƒÏ„Î¿ cache
    extraCitiesCache[cityName] = cityData;
    console.log(`âœ… Î•Ï€Î¹Ï„Ï…Ï‡Î®Ï‚ Ï†ÏŒÏÏ„Ï‰ÏƒÎ·: ${cityName} (${cityData.activities?.length || 0} Î´ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„ÎµÏ‚)`);
    
    return cityData;
    
  } catch (error) {
    console.error(`âŒ Î£Ï†Î¬Î»Î¼Î± Ï†ÏŒÏÏ„Ï‰ÏƒÎ·Ï‚ ${cityName}:`, error);
    return null;
  }
}

// Î’ÎŸÎ—Î˜Î—Î¤Î™ÎšÎ— Î£Î¥ÎÎ‘Î¡Î¤Î—Î£Î—: Î•Ï€Î¹ÏƒÏ„ÏÎ­Ï†ÎµÎ¹ true Î±Î½ Î· Ï€ÏŒÎ»Î· ÎµÎ¯Î½Î±Î¹ Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î·
function isExtraCityAvailable(cityName) {
  return EXTRA_CITIES_CONFIG[cityName] && EXTRA_CITIES_CONFIG[cityName].enabled;
}

// Î•ÎÎ—ÎœÎ•Î¡Î©Î£Î— Î¤Î—Î£ Î›Î•Î™Î¤ÎŸÎ¥Î¡Î“Î™Î‘Î£ goToStep4 Î£ÎŸÎ¥
async function checkAndLoadExtraCity(cityName) {
  if (isExtraCityAvailable(cityName)) {
    return await loadExtraCity(cityName);
  }
  return null;
}

// Î•ÎÎ—ÎœÎ•Î¡Î©Î£Î— Î¤Î—Î£ Î›Î•Î™Î¤ÎŸÎ¥Î¡Î“Î™Î‘Î£ filterDestinations Î£ÎŸÎ¥
function addExtraCitiesToFilter() {
  const extraCityNames = Object.keys(EXTRA_CITIES_CONFIG).filter(name => EXTRA_CITIES_CONFIG[name].enabled);
  console.log(`ğŸŒ Î•Î¾Ï‰Ï„ÎµÏÎ¹ÎºÎ­Ï‚ Ï€ÏŒÎ»ÎµÎ¹Ï‚ Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼ÎµÏ‚: ${extraCityNames.join(', ')}`);
  return extraCityNames;
}

// ==================== Î Î¡ÎŸÎ•Î¤ÎŸÎ™ÎœÎ‘Î£Î™Î‘ Î Î‘Î¡Î‘Î”Î•Î™Î“ÎœÎ‘Î¤ÎŸÎ£ ====================

// Î‘Ï…Ï„ÏŒÎ¼Î±Ï„Î± Ï†Ï„Î¹Î¬Ï‡Î½ÎµÎ¹ Î­Î½Î± Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î± Î±ÏÏ‡ÎµÎ¯Î¿Ï… Î±Î½ Î´ÎµÎ½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹
async function createExampleFile() {
  try {
    // ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ Î±Î½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ Î¿ Ï†Î¬ÎºÎµÎ»Î¿Ï‚ data
    const testResponse = await fetch('data/test.txt', { method: 'HEAD' });
    
    // Î‘Î½ Î¿ Ï†Î¬ÎºÎµÎ»Î¿Ï‚ Î´ÎµÎ½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹, Î´Î·Î¼Î¹Î¿ÏÏÎ³Î·ÏƒÎµ Ï„Î¿ Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±
    const exampleData = {
      "city": "Î Î±ÏÎ¯ÏƒÎ¹",
      "country": "Î“Î±Î»Î»Î¯Î±",
      "description": "Î— Ï€ÏŒÎ»Î· Ï„Î¿Ï… Ï†Ï‰Ï„ÏŒÏ‚ ÎºÎ±Î¹ Ï„Î·Ï‚ Î±Î³Î¬Ï€Î·Ï‚",
      "coordinates": { "lat": 48.8566, "lng": 2.3522 },
      "currency": "â‚¬",
      "activities": [
        {
          "name": "Disneyland Paris",
          "desc": "Î¤Î¿ Î´Î¹Î¬ÏƒÎ·Î¼Î¿ Î¸ÎµÎ¼Î±Ï„Î¹ÎºÏŒ Ï€Î¬ÏÎºÎ¿ Disney",
          "emoji": "ğŸ°",
          "prices": { "0-2": 0, "3-5": 45, "6-14": 55, "15-19": 65, "18+": 75 },
          "lat": 48.8722, "lng": 2.7758,
          "restaurant": "<a href='https://maps.google.com/?q=Disneyland+Restaurant+Paris' target='_blank'>Disney Restaurant</a>",
          "website": "https://www.disneylandparis.com/",
          "duration": "6-8 ÏÏÎµÏ‚",
          "bestFor": ["ÎŸÎ¹ÎºÎ¿Î³Î­Î½ÎµÎ¹ÎµÏ‚", "Î Î±Î¹Î´Î¹Î¬"]
        }
      ]
    };
    
    console.log("ğŸ“ Î Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î± Î´Î¿Î¼Î®Ï‚ JSON Î­Ï„Î¿Î¹Î¼Î¿ Î³Î¹Î± Î±Î½Ï„Î¹Î³ÏÎ±Ï†Î®");
    return exampleData;
    
  } catch (error) {
    console.log("â„¹ï¸ ÎŸ Ï†Î¬ÎºÎµÎ»Î¿Ï‚ data Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ Î®Î´Î·");
    return null;
  }
}

// Î‘Î¥Î¤ÎŸÎœÎ‘Î¤Î— Î•ÎšÎšÎ™ÎÎ—Î£Î—
document.addEventListener('DOMContentLoaded', function() {
  console.log("ğŸš€ Î£ÏÏƒÏ„Î·Î¼Î± ÎµÎ¾Ï‰Ï„ÎµÏÎ¹ÎºÏÎ½ Ï€ÏŒÎ»ÎµÏ‰Î½ Î­Ï„Î¿Î¹Î¼Î¿!");
  console.log("ğŸ’¡ Î ÏÎ¿ÏƒÎ¸Î­ÏƒÏ„Îµ Ï€ÏŒÎ»ÎµÎ¹Ï‚ ÏƒÏ„Î¿Î½ Ï€Î¯Î½Î±ÎºÎ± EXTRA_CITIES_CONFIG");
  
  // Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Ï€Î±ÏÎ±Î´ÎµÎ¯Î³Î¼Î±Ï„Î¿Ï‚ Î±Î½ Î¸Î­Î»ÎµÎ¹ Î¿ Ï‡ÏÎ®ÏƒÏ„Î·Ï‚
  setTimeout(createExampleFile, 1000);
});

// ==================== Î•ÎÎ‘Î“Î©Î“Î— Î£Î¥ÎÎ‘Î¡Î¤Î—Î£Î•Î©Î ====================
// (Î“Î¹Î± Î½Î± Ï„Î¹Ï‚ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎµÎ¹ Î¿ ÎºÏÏÎ¹Î¿Ï‚ ÎºÏÎ´Î¹ÎºÎ¬Ï‚ ÏƒÎ¿Ï…)
window.TravelPlannerExtensions = {
  loadExtraCity,
  isExtraCityAvailable,
  checkAndLoadExtraCity,
  addExtraCitiesToFilter,
  getExtraCitiesList: () => Object.keys(EXTRA_CITIES_CONFIG).filter(name => EXTRA_CITIES_CONFIG[name].enabled)
};